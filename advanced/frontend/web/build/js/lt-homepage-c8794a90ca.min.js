/* Build by Ltvieri 2017/03/10 14:31:14 */
(function(){"use strict";var t=this,e=t.jQuery;"undefined"==typeof t.blog&&(t.blog={}),t.blog.homepage={init:function(){this.getKeywords(),this.getPm2_5(),this.getNewarticle()},getPm2_5:function(){e.ajax({url:"../post/aqi",type:"get",dataType:"json",cache:!0,success:function(t){var a;t&&t.aqi_pm25?(a=t.aqi_pm25,e(".pm2_5").html(a)):console.warn("获取pm2.5数据出错。")}})},getNewarticle:function(){var t=this;e.get("/post/get-newarticle?range=1to3").done(function(a){if("string"!=typeof a)return console.warn("获取文章失败");try{var i=JSON.parse(a)}catch(t){return console.log("数据格式错误"+t)}if(i.status&&"error"===i.status)return console.log(i.msg);if(i.status&&"success"===i.status){for(var n=e(".article-container"),r=i.msg,s="",o=0,l=r.length;o<l;o++)s+='\t\t\t\t\t\t\t<article class="panel panel-default">\t\t\t\t\t\t\t\t<div class="panel-heading post-head">\t\t\t\t\t\t\t\t\t'+t._formatCreatetime(r[o].update_time)+'\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div class="panel-body post-content">\t\t\t\t\t\t\t\t\t<h3 class="post-head">'+r[o].title+"</h3>\t\t\t\t\t\t\t\t\t"+t.getFirstPara(r[o].content)+'\t\t\t\t\t\t\t\t\t<a class="pull-right" href="/article/'+r[o].id+"/"+r[o].title+'" title="'+r[o].title+'"> >>>查看详情</a>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</article>\t\t\t\t\t\t\t';n.append(s)}})},_formatCreatetime:function(t){if("string"!=typeof t)return t;var e=t.split(" ")[0];return e},getFirstPara:function(t){if("string"!=typeof t)return"";var e=/<p>[\s\S]*?<\/p>/g,a=t.match(e),i=a[0];return i},getKeywords:function(){var t=this;e.get("/post/get-keywords").done(function(e){var a=JSON.parse(e);t._showKeyword(a)})},_showKeyword:function(t){if("string"!=typeof t)return t;for(var a=t.split(","),i=e(".tags-container"),n=0;n<a.length;n++)i.tags({content:a[n],canRemove:"false"});this._showKeywordPage()},_showKeywordPage:function(){var t=this;e(".tags-container").on("click",".tag-container",function(){var a=e(this).find(".lt-tag").text();t._getArticleByTag(a)})},_getArticleByTag:function(t){var a=this;e.get("/post/get-article-by-tag?tag="+t).done(function(e){if(e=JSON.parse(e),e&&"fundefined"!=typeof e.msg&&"error"!==e.msg){var i=e.msg;a._filloutAritcleByTag(i,t)}else console.log("获取文章失败")})},_filloutAritcleByTag:function(t,a){for(var i="",n=0,r=t.length;n<r;n++)i+='\t\t\t\t\t<li>\t\t\t\t\t\t<a href="'+t[n].id+"/article/"+t[n].title+'/" title="'+t[n].title+'">'+t[n].title+'</a>\t\t\t\t\t\t<span class="pv pull-right">'+this._formatCreatetime(t[n].create_time)+"</span>\t\t\t\t\t</li>";var s=e(".tag-article-container");if(1===s.length){var o=e(".tag-article");o.html(""),o.append(i),e(".tag-name").text(a)}else{var l='\t\t\t\t\t<div class="panel panel-default tag-article-container">\t\t\t\t\t\t<div class="panel-heading">\t\t\t\t\t\t\t分类文章 : <span class="tag-name">'+(a||"")+'<span>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="panel-body">\t\t\t\t\t\t\t<ul class="tag-article">'+i+"</ul>\t\t\t\t\t\t</div>\t\t\t\t\t</div>",c=e("main.list-container");c.prepend(l)}}}}).call(this),$(document).ready(function(){"use strict";var t=window;t.jQuery;t.blog.homepage.init()});