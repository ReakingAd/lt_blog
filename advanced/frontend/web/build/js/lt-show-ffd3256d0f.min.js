/* Build by Ltvieri 2017/03/13 18:09:48 */
(function(){"use strict";var t=this,e=t.jQuery;"undefined"==typeof t.blog&&(t.blog={}),t.blog.show={init:function(){this.getAritcleById(),this.goEditArticle(),this.countPv(),this.getRelatedAritlce(),this.filloutArticle(),this.showKeyword()},_getCurrentId:function(){var t=window.location.pathname,e=t.split("/")[2];return e},getAritcleById:function(){var t=this._getCurrentId();e.get("/post/get-article-by-id?id="+t).done(function(t){if("string"!=typeof t)return console.log("文章有误");if(t=JSON.parse(t),"undefined"==typeof t.status||"error"===t.status)return console.log(msg);var e=t.msg;Pubsub.trigger("gotAritcle",e)})},filloutArticle:function(){Pubsub.listen("gotAritcle",function(t){if("undefined"==typeof t)return console.log("获取文章失败");var n=lt_values.isGuset,o="true"===n?"":'<button class="btn-edit btn btn-default btn-sm pull-right">修改</button>',i="\t\t\t\t\t<h2>"+(t.title||"")+'</h2>\t\t\t\t\t<p class="clearfix">\t\t\t\t\t\t<span>点击量：</span><span class="click">'+(t.pv||"")+'</span>\t\t\t\t\t\t<span>日期：</span><span class="update-date">'+(t.create_time||"")+"</span>\t\t\t\t\t\t\t"+o+"\t\t\t\t\t</p>\t\t\t\t",s=e(".article-desc");s.append(i);var r=t.content||"",c=e(".article-container");c.append(r)})},goEditArticle:function(){var n=this;e(".article-desc").on("click",".btn-edit",function(){var e=n._getCurrentId(),o=t.blog.global.message.server="/create?id="+e;window.location.href=o})},countPv:function(){var t=this,n={id:t._getCurrentId()};e.ajax({url:"/post/count-pv",type:"post",dataType:"json",data:n,success:function(t){(t.result="success")&&console.log("============== count =============")}})},showKeyword:function(){Pubsub.listen("gotAritcle",function(t){for(var n=t.keyword,o=n.split(","),i=e(".keyword-container"),s=0;s<o.length;s++)i.tags({content:o[s],canRemove:"false"})})},getRelatedAritlce:function(){Pubsub.listen("gotAritcle",function(t){if("undefined"==typeof t)return console.log("wrong param");var e=t.keyword,n=e.split(",");console.log(n)})}}}).call(this),$(document).ready(function(){"use strict";var t=window;t.jQuery;t.blog.show.init()});