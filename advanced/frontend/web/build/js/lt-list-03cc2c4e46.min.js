/* Build by Ltvieri 2017/03/11 18:31:44 */
(function(){"use strict";var t=this,e=t.jQuery;"undefined"==typeof t.blog&&(t.blog={}),t.blog.show={init:function(){this.initSpin(),this.getPm2_5(),this.getPaginationArticle(),this.getArticleHot(),this.getArticleNew(),this.getKeywords()},initSpin:function(){for(var t={lines:12,length:7,width:4,radius:10,scale:1,corners:1,color:"#999",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"},e=document.getElementsByClassName("spin-container"),i=0;i<e.length;i++){new Spinner(t).spin(e[i])}},getPm2_5:function(){var t=e(".pm2_5");e.ajax({url:"../post/aqi",type:"get",dataType:"json",cache:!0,beforeSend:function(){var e='<img src="/images/loading.gif" alt="">';t.append(e)},success:function(e){var i;e&&e.aqi_pm25?(i=e.aqi_pm25,t.html(i)):console.warn("获取pm2.5数据出错。")}})},getPaginationArticle:function(){var t=this;e(".x_page_container .lt-pagination").LTPagination({ajaxUrl:"/post/get-article-pagination",ajaxCallback:t._filloutPaginationArticle,pageSize:15,ajaxExtraParam:{}})},_filloutPaginationArticle:function(t){var i=[];if(!(t&&t.list.length>0))return console.log("无可用数据.");i=t.list;for(var a="",l=0;l<i.length;l++){var n=i[l].title,r=i[l].create_time.split(" ")[0],o="/article/"+i[l].id+"/"+i[l].title,s=i[l].status,c="";"2"===s&&(c='<i class="draft-label pull-left">[草稿]</i>'),a+='<li><a class="pull-left" href="'+o+'">'+n+"</a>"+c+'<span class="update-time pull-right">'+r+"</span></li>"}var p=e(".article-all");p.html(""),p.append(a),e(".article-all-wrapper .spin-container").remove(),e(".article-all").removeClass("opacity-0")},getArticleHot:function(){var t=this,i=10;e.get("/post/get-article-hot?sum="+i).done(function(e){t._filloutAritcleHot(e)})},_filloutAritcleHot:function(t){var i=JSON.parse(t).msg;if("object"!=typeof i)return console.log("数据有误");for(var a="",l=e(".article-hot"),n=0,r=i.length;n<r;n++)a+='\t\t\t\t\t<li>\t\t\t\t\t\t<a href="/article/'+i[n].id+"/"+i[n].title+'" title="'+i[n].title+'">'+i[n].title+'</a>\t\t\t\t\t\t<span class="pv pull-right">'+i[n].pv+"</span>\t\t\t\t\t</li>\t\t\t\t\t";l.removeClass("article-hot-empty"),l.find("li").remove(),l.append(a),e(".article-hot-wrapper .spin-container").remove(),e(".article-hot").removeClass("opacity-0")},getArticleNew:function(){var t=this,i=10;e.get("/post/get-article-new?range=1to"+i).done(function(e){t._filloutAritcleNew(e)})},_filloutAritcleNew:function(t){var i=JSON.parse(t).msg;if("object"!=typeof i)return console.log("数据有误");for(var a="",l=e(".article-latest"),n=0,r=i.length;n<r;n++)a+='\t\t\t\t\t<li>\t\t\t\t\t\t<a href="/article/'+i[n].id+"/"+i[n].title+'" title="'+i[n].title+'">'+i[n].title+'</a>\t\t\t\t\t\t<span class="pv pull-right">'+this._formatCreatetime(i[n].create_time)+"</span>\t\t\t\t\t</li>\t\t\t\t\t";l.append(a),e(".article-latest-wrapper .spin-container").remove(),e(".article-latest").removeClass("opacity-0")},_formatCreatetime:function(t){if("string"!=typeof t)return t;var e=t.split(" ")[0];return e},getKeywords:function(){var t=this;e.get("/post/get-keywords").done(function(e){var i=JSON.parse(e);t._showKeyword(i)})},_showKeyword:function(t){if("string"!=typeof t)return t;for(var i=t.split(","),a=e(".tags-container"),l=0;l<i.length;l++)a.tags({content:i[l],canRemove:"false"});this._bindingShowKeywordArticle()},_bindingShowKeywordArticle:function(){var t=this;e(".tags-container").on("click",".tag-container",function(){var i=e(this).find(".lt-tag").text();t._getArticleByTag(i)})},_getArticleByTag:function(t){var i=this;e.get("/post/get-article-by-tag?tag="+t).done(function(e){if(e=JSON.parse(e),e&&"fundefined"!=typeof e.msg&&"error"!==e.msg){var a=e.msg;i._filloutAritcleByTag(a,t)}else console.log("获取文章失败")})},_filloutAritcleByTag:function(t,i){for(var a="",l=0,n=t.length;l<n;l++)a+='\t\t\t\t\t<li>\t\t\t\t\t\t<a href="/article/'+t[l].id+"/"+t[l].title+'" title="'+t[l].title+'" target="_blank">'+t[l].title+'</a>\t\t\t\t\t\t<span class="pv pull-right">'+this._formatCreatetime(t[l].create_time)+"</span>\t\t\t\t\t</li>";var r=e(".tag-article-container");if(1===r.length){var o=e(".tag-article");o.html(""),o.append(a),e(".tag-name").text(i)}else{var s='\t\t\t\t\t<div class="panel panel-default tag-article-container">\t\t\t\t\t\t<div class="panel-heading">\t\t\t\t\t\t\t分类文章 : <span class="tag-name">'+(i||"")+'<span>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="panel-body">\t\t\t\t\t\t\t<ul class="tag-article">'+a+"</ul>\t\t\t\t\t\t</div>\t\t\t\t\t</div>",c=e("main.list-container");c.prepend(s)}}}}).call(this),$(document).ready(function(){"use strict";var t=window;t.jQuery;t.blog.show.init()});