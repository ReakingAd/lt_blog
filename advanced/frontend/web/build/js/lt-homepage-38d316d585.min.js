/* Build by Ltvieri 2017/03/09 23:24:35 */
(function(){"use strict";var t=this,e=t.jQuery;"undefined"==typeof t.blog&&(t.blog={}),t.blog.homepage={init:function(){this.getKeywords(),this.showKeywordPage(),this.getPm2_5(),this.getNewarticle()},getKeywords:function(){var t=this;e.get("/post/get-keywords").done(function(e){t.showKeyword(e)})},showKeyword:function(t){for(var n=JSON.parse(t).split(","),a=e(".tags-container"),i=0;i<n.length;i++)a.tags({content:n[i],canRemove:"false"})},showKeywordPage:function(){e(".tags-container").on("click",".tag-container",function(){var t=e(this).find(".lt-tag").text();window.location.href=lt_global.baseurl+"/list/tags/"+t})},getPm2_5:function(){e.ajax({url:"../post/aqi",type:"get",dataType:"json",cache:!0,success:function(t){var n;t&&t.aqi_pm25?(n=t.aqi_pm25,e(".pm2_5").html(n)):console.warn("获取pm2.5数据出错。")}})},getNewarticle:function(){var t=this;e.get("/post/get-newarticle?range=1to3").done(function(n){if("string"!=typeof n)return console.warn("获取文章失败");try{var a=JSON.parse(n)}catch(t){return console.log("数据格式错误"+t)}if(a.status&&"error"===a.status)return console.log(a.msg);if(a.status&&"success"===a.status){for(var i=e(".article-container"),o=a.msg,s="",r=0,c=o.length;r<c;r++)s+='\t\t\t\t\t\t\t<article class="panel panel-default">\t\t\t\t\t\t\t\t<div class="panel-heading post-head">\t\t\t\t\t\t\t\t\t'+t.formatTime(o[r].update_time)+'\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<div class="panel-body post-content">\t\t\t\t\t\t\t\t\t<h3 class="post-head">'+o[r].title+"</h3>\t\t\t\t\t\t\t\t\t"+t.getFirstPara(o[r].content)+'\t\t\t\t\t\t\t\t\t<a class="pull-right" href="/article/'+o[r].id+"/"+o[r].title+'" title="'+o[r].title+'"> >>>查看详情</a>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</article>\t\t\t\t\t\t\t';i.append(s)}})},formatTime:function(t){if("string"!=typeof t)return t;var e=t.split(" ")[0];return e},getFirstPara:function(t){if("string"!=typeof t)return"";var e=/<p>[\s\S]*?<\/p>/g,n=t.match(e),a=n[0];return a}}}).call(this),$(document).ready(function(){"use strict";var t=window;t.jQuery;t.blog.homepage.init()});